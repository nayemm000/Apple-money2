<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Special Independence Day message waiting for you</title>
<style>
/* ============================
   INDEPENDENCE DAY - Single File
   All CSS inline. No external libs.
   Uses rakhi.gif and rakhi.mp3 (local) as provided.
   ============================ */

/* Reset & base */
:root{
  --bg1:#0b0120;
  --bg2:#140a2e;
  --accent-magenta: #ff2d95;
  --accent-cyan: #00f0ff;
  --accent-gold: #ffd166;
  --glass: rgba(255,255,255,0.04);
  --neon: 0 0 20px rgba(255,0,150,0.18);
  --neon-strong: 0 0 30px rgba(0,255,255,0.12);
  --font-stack: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:linear-gradient(120deg,var(--bg1),var(--bg2));font-family:var(--font-stack);overflow:hidden;}
a{color:inherit;text-decoration:none}

/* Full viewport container, no scroll */
.app{
  height:100vh;width:100vw;position:relative;display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}

/* Animated shifting neon gradient background */
.bg-animated{
  position:absolute;inset:0;z-index:0;
  background: radial-gradient(600px circle at 10% 10%, rgba(255,45,149,0.06), transparent 8%),
              radial-gradient(600px circle at 90% 80%, rgba(0,240,255,0.04), transparent 10%),
              linear-gradient(135deg, rgba(11,1,32,1) 0%, rgba(20,10,46,1) 100%);
  animation: bgShift 12s linear infinite;
  filter:blur(30px) saturate(1.2);
}
@keyframes bgShift{
  0%{transform:scale(1) rotate(0deg)}
  50%{transform:scale(1.05) rotate(1deg)}
  100%{transform:scale(1) rotate(0deg)}
}

/* Landing screen */
.landing{
  position:absolute;inset:0;z-index:5;display:flex;flex-direction:column;align-items:center;justify-content:center;
  backdrop-filter: blur(2px);
  transition:opacity .9s ease, transform .9s ease;
}
.landing.hidden{opacity:0;pointer-events:none;transform:scale(.98)}

/* Landing central card */
.l-card{
  width:clamp(300px,68vw,920px);max-width:92%;padding:28px;border-radius:18px;text-align:center;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 10px 40px rgba(0,0,0,0.6), var(--neon);
  transform-origin:center;
  animation: landingPulse 6s ease-in-out infinite;
}
@keyframes landingPulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.03)}
  100%{transform:scale(1)}
}
.l-title{
  color:white;font-weight:700;font-size:clamp(18px,4.1vw,34px);letter-spacing:0.6px;
  text-shadow: 0 0 18px rgba(255,255,255,0.04);
  margin-bottom:18px;
}
.l-sub{color:rgba(255,255,255,0.75);font-size:clamp(13px,2vw,16px);margin-bottom:22px}
.reveal-btn{
  display:inline-block;padding:14px 28px;border-radius:999px;font-weight:700;cursor:pointer;
  background:linear-gradient(90deg,var(--accent-magenta),var(--accent-cyan));
  box-shadow: 0 0 28px rgba(255,45,149,0.12), 0 8px 30px rgba(0,0,0,0.6);
  color:white;border:2px solid rgba(255,255,255,0.06);
  transition:transform .25s ease, box-shadow .25s ease;
  text-transform:uppercase;letter-spacing:1px;
}
.reveal-btn:hover{transform:translateY(-4px);box-shadow: 0 0 36px rgba(0,255,255,0.12)}
.reveal-small{font-size:12px;display:block;margin-top:10px;color:rgba(255,255,255,0.7)}

/* Main celebration stage (visible after reveal) */
.stage{
  position:absolute;inset:0;z-index:4;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  padding:18px;gap:16px;
  opacity:0;pointer-events:none;transition:opacity .9s ease .2s;
}
.stage.visible{opacity:1;pointer-events:auto}

/* Top center rakhi (we'll use provided rakhi.gif as hero visual) */
.hero-img{
  width:clamp(180px,48vw,640px);max-width:94%;
  border-radius:14px;display:block;object-fit:cover;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 40px rgba(255,45,149,0.06);
  transform-origin:center;
  animation: heroPulse 5.5s ease-in-out infinite;
  border: 1px solid rgba(255,255,255,0.04);
}
@keyframes heroPulse{
  0%{transform:scale(1) translateY(0)}
  50%{transform:scale(1.03) translateY(-6px)}
  100%{transform:scale(1) translateY(0)}
}

/* "Happy Independence Day" header with disco/backlight */
.header-wrap{
  margin-top:18px;display:flex;flex-direction:column;align-items:center;gap:8px;
}
.happy-title{
  font-size:clamp(18px,5vw,52px);font-weight:800;color:white;text-align:center;
  letter-spacing:0.6px;padding:10px 20px;border-radius:14px;
  position:relative;
  z-index:3;
  /* dual-color animated glow behind text */
  background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 8px 40px rgba(0,0,0,0.6);
}
.happy-illum {
  position:absolute;inset:0;z-index:2;border-radius:14px;pointer-events:none;
  filter:blur(18px);mix-blend-mode:screen;opacity:0.9;
  animation: illum 6s linear infinite;
}
@keyframes illum{
  0%{background: radial-gradient(40% 60% at 10% 10%, rgba(255,45,149,0.18), transparent 10%), radial-gradient(30% 40% at 90% 90%, rgba(0,240,255,0.12), transparent 12%)}
  50%{background: radial-gradient(40% 60% at 90% 10%, rgba(255,197,0,0.15), transparent 10%), radial-gradient(30% 40% at 10% 90%, rgba(0,240,255,0.12), transparent 12%)}
  100%{background: radial-gradient(40% 60% at 10% 10%, rgba(255,45,149,0.18), transparent 10%), radial-gradient(30% 40% at 90% 90%, rgba(0,240,255,0.12), transparent 12%)}
}
/* disco rotating ring */
.disco-ring{
  position:absolute;inset:-6px;border-radius:16px;z-index:1;pointer-events:none;
  background: conic-gradient(from 0deg, rgba(255,45,149,0.25), rgba(0,240,255,0.25), rgba(255,197,0,0.25), rgba(255,45,149,0.25));
  filter:blur(14px);opacity:0.9;
  animation: spin 6s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* Greeting card area (name + message) */
.greeting{
  margin-top:6px;padding:16px;border-radius:12px;min-width:280px;max-width:92%;
  backdrop-filter: blur(6px);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 10px 36px rgba(0,0,0,0.6);
  display:flex;flex-direction:column;align-items:center;gap:8px;
}
.greet-name{
  font-weight:900;font-size:clamp(18px,4.4vw,34px);text-align:center;padding:6px 10px;border-radius:8px;
  color:white;position:relative;
  animation: nameGlow 3s ease-in-out infinite;
  letter-spacing:0.6px;
}
@keyframes nameGlow{
  0%{text-shadow: 0 0 6px rgba(0,255,255,0.06)}
  50%{text-shadow: 0 0 22px rgba(255,45,149,0.18)}
  100%{text-shadow: 0 0 6px rgba(0,255,255,0.06)}
}
.greet-msg{
  font-size:clamp(14px,3.6vw,20px);color:rgba(255,255,255,0.9);text-align:center;padding:6px 12px;border-radius:6px;
  background:linear-gradient(90deg, rgba(0,255,255,0.02), rgba(255,197,0,0.02));
}

/* Inputs and buttons row */
.controls{
  margin-top:12px;display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center;width:100%;
}
.input,textarea{
  background:rgba(0,0,0,0.35);border-radius:10px;padding:12px 14px;color:white;border:1px solid rgba(255,255,255,0.06);
  outline:none;font-size:14px;min-width:220px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.5);
}
.input::placeholder{color:rgba(255,255,255,0.45)}
textarea{min-height:64px;resize:none}

/* Neon input border */
.neon-border{border:2px solid rgba(0,0,0,0.2);position:relative}
.neon-border:focus-within{box-shadow: 0 0 28px rgba(0,255,255,0.06), 0 0 30px rgba(255,45,149,0.04)}

/* Gift button (affiliate) */
.gift-button{
  display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:14px;background:linear-gradient(90deg,#222, #111);
  border:2px solid rgba(255,197,0,0.08);color:var(--accent-gold);font-weight:800;cursor:pointer;
  box-shadow: 0 10px 34px rgba(255,197,0,0.04), 0 0 26px rgba(255,45,149,0.02);text-decoration:none;
  transform-origin:center;
  animation: giftPulse 4s ease-in-out infinite;
}
@keyframes giftPulse{
  0%{transform:translateY(0)}
  50%{transform:translateY(-6px) scale(1.02)}
  100%{transform:translateY(0)}
}

/* Hand pointer animation next to gift text */
.hand-anim{display:inline-block;animation: handBounce 1.4s ease-in-out infinite}
@keyframes handBounce{
  0%{transform:translateY(0)}
  50%{transform:translateY(-8px)}
  100%{transform:translateY(0)}
}

/* WhatsApp share */
.share-btn{
  display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;background:#075e54;color:white;font-weight:700;
  box-shadow: 0 8px 28px rgba(7,94,84,0.14);border:1px solid rgba(255,255,255,0.04);
}
.share-btn img{width:18px;height:18px}

/* Canvas layers for effects */
.canvas-wrap{position:absolute;inset:0;z-index:2;pointer-events:none}
#effects-canvas{position:absolute;inset:0;width:100%;height:100%}

/* Floating emoji flowers and balloons wrapper */
.floats{position:absolute;inset:0;z-index:3;pointer-events:none;overflow:hidden}

/* Balloons style (dom elements) */
.balloon{
  position:absolute;top:-120px;border-radius:50%;padding:12px 14px;color:white;font-weight:800;
  text-align:center;font-size:16px;display:flex;align-items:center;justify-content:center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.45), 0 0 18px rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.03);
  filter: drop-shadow(0 6px 20px rgba(0,0,0,0.55));
  animation: balloonDrift linear infinite;
}
@keyframes balloonDrift{
  0%{transform:translateY(-10vh) rotate(0deg);opacity:0}
  10%{opacity:1}
  100%{transform:translateY(120vh) rotate(360deg);opacity:0.95}
}

/* Flower emoji falling spans */
.emoji-fall{
  position:absolute;font-size:20px;will-change:transform,opacity;pointer-events:none;
  animation: fall linear forwards;
}
@keyframes fall{
  0%{transform:translateY(-10vh) rotate(0deg);opacity:0}
  10%{opacity:1}
  100%{transform:translateY(110vh) rotate(720deg);opacity:0.9}
}

/* Responsive tweaks */
@media (min-width:900px){
  .stage{justify-content:flex-start;padding-top:36px}
  .hero-img{margin-top:6px}
}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="bg-animated" aria-hidden="true"></div>

  <!-- Canvas for fireworks/confetti/sparkles -->
  <div class="canvas-wrap" aria-hidden="true">
    <canvas id="effects-canvas"></canvas>
  </div>

  <!-- floating DOM-based elements (flowers & balloons) -->
  <div class="floats" id="floats"></div>

  <!-- LANDING SCREEN -->
  <div class="landing" id="landing">
    <div class="l-card" role="dialog" aria-labelledby="landingTitle" aria-describedby="landingSub">
      <div class="l-title" id="landingTitle">Special Independence Day message waiting for you</div>
      <div class="l-sub" id="landingSub">Celebrate the spirit of freedom with a glowing neon surprise ‚Äî click below to reveal.</div>
      <button class="reveal-btn" id="revealBtn" aria-label="Click to reveal celebration">Click to Reveal</button>
      <div class="reveal-small">Tap the button to start music & celebration</div>
    </div>
  </div>

  <!-- MAIN CELEBRATION STAGE (hidden initially) -->
  <main class="stage" id="stage" role="main" aria-live="polite">
    <!-- Hero image (uses local rakhi.gif as provided; you may replace with a NATIONAL GIF) -->
    <img src="rakhi.gif" alt="Independence Animated Visual" class="hero-img" id="heroImg" />

    <!-- Header with disco/backlight -->
    <div class="header-wrap" style="position:relative;">
      <div class="happy-title" id="titleWrap">
        <div style="position:relative;z-index:4">Happy Independence Day</div>
        <div class="disco-ring" style="width:calc(100% + 12px);height:calc(100% + 12px);"></div>
        <div class="happy-illum" style="border-radius:14px;"></div>
      </div>
    </div>

    <!-- Greeting card: Name + Message -->
    <section class="greeting" id="greetingCard">
      <div class="greet-name" id="greetName">Someone</div>
      <div class="greet-msg" id="greetMsg">aapko Independence Day ki bahut bahut badhai</div>

      <!-- Inputs & actions -->
      <div class="controls" id="controls">
        <div style="display:flex;gap:8px;flex-direction:column">
          <div class="neon-border">
            <input id="nameInput" class="input" placeholder="Enter your name (e.g., Rahul)" />
          </div>
          <div class="neon-border">
            <textarea id="msgInput" class="input" placeholder="Type your message (multi-line allowed)">Wishing you freedom, pride and progress!</textarea>
          </div>
        </div>

        <!-- Buttons -->
        <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
          <!-- üî•üî• AFFILIATE LINK PLACEHOLDER -->
          <!-- üî•üî• PASTE YOUR AMAZON AFFILIATE LINK BELOW üî•üî• -->
          <!-- Example: <a href="https://www.amazon.in/your-affiliate-link" target="_blank" class="gift-button">üéÅ Special Independence Gifts üéÅ üëá</a> -->
          <a href="YOUR_AFFILIATE_LINK" target="_blank" class="gift-button" id="giftBtn">üéÅ Special Independence Gifts üéÅ <span class="hand-anim">üëá</span></a>

          <!-- WhatsApp share -->
          <button class="share-btn" id="shareBtn" title="Share via WhatsApp">
            <img src="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzAgMzAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTI0LjQxNyA1LjU4M2MtMS4zLTMuMDY0LTMuOTYtNC42ODEtNi44NzctNC42ODFIMTAuNDE2Yy0zLjY3OCAwLTYuNjE5IDMuNjY3LTYuMTI0IDcuNjM2LjQ5MyA0LjA3NSA0LjEwNSA3LjQyNSA4LjI4NyA3LjQyNmgxLjc0M3YtNS4yN2MtMS41OTYtLjg0Ny0yLjg1Ni0yLjM2OS0zLjI1OS0zLjgwMy4xMzUtLjAwNy4yNjYtLjAwNy4zOTktLjAwNyAxLjQyNiAwIDIuNzAzIDEuMDE4IDMuNTEzIDEuNjQ3Ljc4MS40NjcuOTc3IDEuMDc1Ljk2MyAxLjU0MS4wMDAuMzA0LS4wNDEuNDQ4LS4wNDEuNDQ4bC0uMDEuMDc4YzEuNjcyLTQuMDU5IDQuNDczLTYuMjk3IDkuMDg0LTYuMjk3IDEuNTQzIDAgMy4xNDMuMjk2IDQuNjM0Ljk0NHYuMjE0YzAgMy4zODUtMi45NDEgNy4yMzgtNi45MzggNy4yMzhjLTMuNjE0IDAtNi4yLTEuNjI5LTguNjM0LTQuNzY5bC00LjM3MyAxLjI4MSAxLjI3OS00LjM3Yy0zLjE0LS4zODktNS43NjMtMi41MjUtNi40NDYtNS4zOSA2LjI2LjAyOCAxMy4xMTcgMi40NDQgMTUuNjgzIDcuMDk0bC4wMDIuMDAxLjAwMi4wMDEuMDAyLjAwMWMwLS4wMDIuMDAyLS4wMDIuMDAyLS4wMDJjMC0uMDAyLjAwMi0uMDAyLjAwMi0uMDAyIiBmaWxsPSIjZmZmIi8+PC9zdmc+" alt="wa" />
            Share on WhatsApp
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Audio element (local rakhi.mp3) -->
  <audio id="bgAudio" src="rakhi.mp3" loop preload="auto"></audio>
</div>

<script>
/*
  Independence Day interactive single-file page
  - Landing screen -> reveal main stage
  - Plays local rakhi.mp3 after user click
  - Music-reactive canvas effects (confetti/fireworks) via WebAudio Analyser
  - Emoji flower fall, balloons DOM layer
  - Name and message come from URL params (?name=...&msg=...) or user inputs
  - WhatsApp share opens with current page link containing ?name & ?msg
*/

/* -----------------------
   Utilities
   ----------------------- */
const $ = sel => document.querySelector(sel);
const qsAll = sel => Array.from(document.querySelectorAll(sel));
const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
function urlParam(key){ return new URLSearchParams(location.search).get(key) }

/* -----------------------
   Elements
   ----------------------- */
const landing = $('#landing');
const revealBtn = $('#revealBtn');
const stage = $('#stage');
const audioEl = $('#bgAudio');
const canvas = document.getElementById('effects-canvas');
const floats = $('#floats');
const heroImg = $('#heroImg');
const greetName = $('#greetName');
const greetMsg = $('#greetMsg');
const nameInput = $('#nameInput');
const msgInput = $('#msgInput');
const giftBtn = $('#giftBtn');
const shareBtn = $('#shareBtn');

/* -----------------------
   Defaults (Independence Day prompt applied)
   Hindi defaults for Independence Day as requested
   ----------------------- */
const DEFAULT_NAME = 'Someone';
const DEFAULT_MSG  = 'aapko Independence Day ki bahut bahut badhai';

/* -----------------------
   Handle URL params or inputs
   ----------------------- */
function setGreetingFromParamsOrInputs(){
  const pName = urlParam('name');
  const pMsg  = urlParam('msg');
  const name = pName ? decodeURIComponent(pName) : (nameInput.value.trim() || DEFAULT_NAME);
  const msg  = pMsg  ? decodeURIComponent(pMsg)  : (msgInput.value.trim()  || DEFAULT_MSG);
  greetName.textContent = `${name} ki taraf se`;
  greetMsg.textContent  = msg;
  // input placeholders reflect source
  if(!pName) nameInput.value = name === DEFAULT_NAME ? '' : name;
  if(!pMsg)  msgInput.value = msg === DEFAULT_MSG ? 'Wishing you freedom, pride and progress!' : msg;
}
setGreetingFromParamsOrInputs();

/* Update greeting when inputs change (live update) */
nameInput.addEventListener('input', () => {
  const name = nameInput.value.trim() || DEFAULT_NAME;
  greetName.textContent = `${name} ki taraf se`;
});
msgInput.addEventListener('input', () => {
  const msg = msgInput.value.trim() || DEFAULT_MSG;
  greetMsg.textContent = msg;
});

/* -----------------------
   WhatsApp share handler
   ----------------------- */
shareBtn.addEventListener('click', () => {
  const name = encodeURIComponent(nameInput.value.trim() || DEFAULT_NAME);
  const msg  = encodeURIComponent(msgInput.value.trim()  || DEFAULT_MSG);
  // Construct share URL that also links to current page with name/msg params
  const pageLink = `${location.origin}${location.pathname}?name=${name}&msg=${msg}`;
  const text = encodeURIComponent(`${nameInput.value.trim() || DEFAULT_NAME} ki taraf se: ${msgInput.value.trim() || DEFAULT_MSG} ‚Äî ${pageLink}`);
  const wa = `https://api.whatsapp.com/send?text=${text}`;
  window.open(wa, '_blank');
});

/* -----------------------
   Reveal flow: start audio + show stage
   ----------------------- */
let audioCtx, analyser, sourceNode, freqData;

async function startAudioAndVisuals(){
  try{
    // Create WebAudio context and analyser for music-reactive visuals
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    const audioSrc = audioEl;
    sourceNode = audioCtx.createMediaElementSource(audioSrc);
    sourceNode.connect(analyser);
    analyser.connect(audioCtx.destination);

    freqData = new Uint8Array(analyser.frequencyBinCount);

    // Play audio (user gesture ensures autoplay permitted)
    await audioEl.play();
    // Some browsers require resume()
    if(audioCtx.state === 'suspended') await audioCtx.resume();

    // Start canvas render loop
    startCanvasLoop();
    // Start periodic falling emojis + balloons
    startFlowersAndBalloons();
  }catch(err){
    console.warn('Audio start error:', err);
  }
}

/* Reveal button */
revealBtn.addEventListener('click', async () => {
  // Fade landing out
  landing.classList.add('hidden');

  // Show stage
  stage.classList.add('visible');

  // Start audio and visuals
  await startAudioAndVisuals();

  // Update greeting (if URL params present)
  setGreetingFromParamsOrInputs();
});

/* -----------------------
   Canvas effects (confetti, fireworks, sparkles)
   Music-reactive using analyser
   ----------------------- */
const ctx = canvas.getContext('2d');
let W, H, particles = [], lastTime = 0;

function resizeCanvas(){
  W = canvas.width = innerWidth * devicePixelRatio;
  H = canvas.height = innerHeight * devicePixelRatio;
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
addEventListener('resize', resizeCanvas);
resizeCanvas();

class Particle {
  constructor(x,y, vx,vy, size, life, hue, type='confetti'){
    this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.size=size;this.life=life;this.hue=hue;this.age=0;this.type=type;
  }
  update(dt){
    this.x += this.vx * dt;
    this.y += this.vy * dt;
    this.vy += 60 * dt; // gravity effect
    this.age += dt;
  }
  draw(ctx){
    ctx.save();
    ctx.globalCompositeOperation = 'lighter';
    if(this.type==='spark'){
      ctx.fillStyle = `hsla(${this.hue},95%,60%,${1 - this.age/this.life})`;
      ctx.beginPath(); ctx.arc(this.x,this.y,this.size*(1 - this.age/this.life),0,Math.PI*2); ctx.fill();
    }else{
      ctx.translate(this.x,this.y);
      ctx.rotate((this.age*10 + this.size)*0.1);
      ctx.fillStyle = `hsl(${this.hue},85%,60%)`;
      ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
    }
    ctx.restore();
  }
}

function spawnBurst(x,y,intensity=1){
  const count = Math.floor(12 * intensity);
  for(let i=0;i<count;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = 120 + Math.random()*220*intensity;
    const vx = Math.cos(angle)*speed;
    const vy = Math.sin(angle)*speed;
    particles.push(new Particle(x,y,vx,vy,4 + Math.random()*6, 0.8 + Math.random()*0.8, Math.random()*360, 'confetti'));
  }
  // sparkles
  for(let i=0;i<8;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = 40 + Math.random()*140*intensity;
    particles.push(new Particle(x,y,Math.cos(angle)*speed,Math.sin(angle)*speed,2 + Math.random()*3,0.6 + Math.random()*0.6, Math.random()*360,'spark'));
  }
}

function startCanvasLoop(){
  lastTime = performance.now();
  requestAnimationFrame(tick);
}

function tick(now){
  const dt = (now - lastTime)/1000; lastTime = now;
  // Analyse audio for beat/volume
  let amplitude = 0;
  if(analyser){
    analyser.getByteFrequencyData(freqData);
    // compute average amplitude on lower-mid frequencies
    let sum=0, count=0;
    for(let i=0;i<freqData.length;i++){
      // focus on bass & lower mids
      if(i < freqData.length * 0.25){
        sum += freqData[i]; count++;
      }
    }
    amplitude = (count ? sum/count : 0) / 255; // 0..1
  }

  // occasionally spawn bursts based on amplitude peaks
  if(Math.random() < amplitude * 0.08 + 0.005){
    const x = Math.random() * W / devicePixelRatio;
    const y = 80 + Math.random()* (H/3 / devicePixelRatio);
    spawnBurst(x,y, 0.6 + amplitude*1.6);
  }

  // update particles
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.update(dt);
    if(p.age > p.life) particles.splice(i,1);
  }

  // draw background subtle
  ctx.clearRect(0,0, W, H);
  // subtle neon radial glow center
  const grad = ctx.createRadialGradient(W/2, H/3, 10, W/2, H/3, Math.max(W,H));
  grad.addColorStop(0, 'rgba(255,45,149,' + (0.06 + amplitude*0.08) + ')');
  grad.addColorStop(0.6, 'rgba(0,240,255,' + (0.02 + amplitude*0.04) + ')');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0, W, H);

  // draw particles
  particles.forEach(p => p.draw(ctx));

  // small periodic fireworks (top center) based on amplitude threshold
  if(amplitude > 0.42 && Math.random() < amplitude * 0.4){
    const x = W/2 / devicePixelRatio * (0.6 + Math.random()*0.8 - 0.4);
    const y = Math.random() * (H/4 / devicePixelRatio) + 40;
    spawnBurst(x,y, 1.2 + amplitude*2.4);
  }

  requestAnimationFrame(tick);
}

/* -----------------------
   Flowers falling & Balloons DOM layer
   ----------------------- */

const flowerEmojis = ['üå∫','üíê','ü•Ä','üåπ','üå∏','üåº','üåª','üåü','üåà'];
function spawnFlower(x){
  const span = document.createElement('div');
  span.className = 'emoji-fall';
  span.style.left = (x || (Math.random()*90 + 5)) + 'vw';
  span.style.top = '-8vh';
  span.style.fontSize = (14 + Math.random()*22) + 'px';
  span.textContent = flowerEmojis[Math.floor(Math.random()*flowerEmojis.length)];
  const duration = 6 + Math.random()*6;
  span.style.animationDuration = duration + 's';
  span.style.animationDelay = (Math.random()*0.6) + 's';
  span.style.transform = `rotate(${Math.random()*90 - 45}deg)`;
  floats.appendChild(span);
  // remove after animation
  setTimeout(()=>span.remove(), (duration+1)*1000);
}

/* Balloons */
function spawnBalloon(){
  const b = document.createElement('div');
  b.className = 'balloon';
  const size = 36 + Math.random()*70;
  b.style.width = size + 'px';
  b.style.height = size + 'px';
  b.style.left = (Math.random()*80 + 5) + 'vw';
  b.style.top = (-40 - Math.random()*60) + 'px';
  // neon random color
  const hue = Math.floor(Math.random()*360);
  b.style.background = `linear-gradient(135deg, hsla(${hue},90%,55%,0.96), hsla(${(hue+40)%360},90%,48%,0.92))`;
  b.style.boxShadow = `0 12px 36px rgba(0,0,0,0.4), 0 0 20px hsla(${hue},90%,60%,0.12)`;
  b.style.animationDuration = (10 + Math.random()*18) + 's';
  b.style.opacity = 0.95;
  b.textContent = 'üéà';
  floats.appendChild(b);
  setTimeout(()=>b.remove(), (parseFloat(b.style.animationDuration)+0.3)*1000);
}

/* Start periodic spawning but reduced density (25%) for flowers as requested */
let flowerInterval, balloonInterval;
function startFlowersAndBalloons(){
  // gentle continuous low-density spawn for flowers
  flowerInterval = setInterval(()=>{
    // 25% density: spawn with lower chance
    if(Math.random() < 0.28) spawnFlower();
  }, 360);
  // balloons slower
  balloonInterval = setInterval(()=>{
    if(Math.random() < 0.35) spawnBalloon();
  }, 1200);
}

/* -----------------------
   Make sure full-screen never scrolls
   ----------------------- */
document.body.style.height = '100vh';
document.documentElement.style.height = '100vh';
document.documentElement.style.overflow = 'hidden';

/* -----------------------
   On load: If URL has params, automatically show them (do not auto-reveal)
   - We will show values in greeting, reveal still required for music/visuals.
   ----------------------- */
window.addEventListener('load', ()=>{
  const pName = urlParam('name');
  const pMsg  = urlParam('msg');
  if(pName) nameInput.value = decodeURIComponent(pName);
  if(pMsg)  msgInput.value = decodeURIComponent(pMsg);
  setGreetingFromParamsOrInputs();
});

/* -----------------------
   Nice accessibility: reveal via Enter key when focused
   ----------------------- */
revealBtn.addEventListener('keydown', (e) => {
  if(e.key === 'Enter' || e.key === ' ') revealBtn.click();
});

/* -----------------------
   Polishing: subtle neon lighting on hero image based on audio amplitude
   ----------------------- */
function animateHeroGlow(){
  if(!analyser) { requestAnimationFrame(animateHeroGlow); return; }
  analyser.getByteFrequencyData(freqData);
  let sum=0, c=0;
  for(let i=0;i<freqData.length;i++){ if(i < freqData.length*0.25){ sum+=freqData[i]; c++ } }
  const amp = (c? sum/c : 0)/255;
  // apply CSS shadow intensity
  heroImg.style.boxShadow = `0 20px 60px rgba(0,0,0,${0.6 - amp*0.2}), 0 0 ${20 + amp*60}px rgba(255,45,149,${0.06 + amp*0.18})`;
  // slightly pulse image scale based on beat
  const scale = 1 + amp * 0.035;
  heroImg.style.transform = `scale(${scale})`;
  requestAnimationFrame(animateHeroGlow);
}
requestAnimationFrame(animateHeroGlow);

/* -----------------------
   Final: ensure all interactive controls are accessible
   ----------------------- */
nameInput.addEventListener('change', ()=> setGreetingFromParamsOrInputs());
msgInput.addEventListener('change', ()=> setGreetingFromParamsOrInputs());

/* End of script */
</script>
</body>
</html>
